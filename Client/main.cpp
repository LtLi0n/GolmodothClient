#include <iostream>
#include <thread>
#include <vector>
#include <string>

#include <stdio.h>
#include <Windows.h>

#include "olcConsoleGameEngineGLOOP.h"
#include "Player.h"
#include "Button.h"
#include "Scene.h"

class Game : public olcConsoleGameEngineGLOOP
{
public:
	Player* player;
	Button* button;

	Game()
	{
		player = new Player(*this);

		button = new Button(*this, 10, 2);
		button->position = { 5, 5 };

		int* tiles = new int[25 * 25]
		{
			1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
			1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
			1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1,
			1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1,
			1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 1,
			1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
			1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1,
			1, 0, 0, 1, 0, 0, 1, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 1, 0, 0, 1, 0, 0, 1,
			1, 0, 1, 1, 1, 0, 1, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 1, 0, 1, 1, 1, 0, 1,
			1, 0, 1, 0, 1, 0, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 2, 2, 1, 0, 1, 0, 1, 0, 1,
			1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 3, 3, 3, 3, 3, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1,
			1, 0, 0, 1, 0, 0, 1, 3, 3, 1, 3, 1, 1, 1, 3, 1, 3, 3, 1, 0, 0, 1, 0, 0, 1,
			1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
			1, 0, 0, 1, 0, 0, 1, 3, 3, 1, 3, 1, 1, 1, 3, 1, 3, 3, 1, 0, 0, 1, 0, 0, 1,
			1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 3, 3, 3, 3, 3, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1,
			1, 0, 1, 0, 1, 0, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 2, 2, 1, 0, 1, 0, 1, 0, 1,
			1, 0, 1, 1, 1, 0, 1, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 1, 0, 1, 1, 1, 0, 1,
			1, 0, 0, 1, 0, 0, 1, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 1, 0, 0, 1, 0, 0, 1,
			1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1,
			1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1,
			1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 1,
			1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1,
			1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1,
			1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
			1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
		};

		player->scene = new Scene(*this, 25, 25, tiles);
	}

protected:

	virtual bool OnUserCreate()
	{
		return true;
	}

	virtual bool OnUserUpdate(float fElapsedTime)
	{
		m_sAppName = L"X: "s + to_wstring(GetMouseX()) + L" Y: "s + to_wstring(GetMouseY());

		Fill(0, 0, m_nScreenWidth, m_nScreenHeight, U' ');

		player->Update();

		DrawString(
			player->position.x * 4,
			player->position.y * 2,
			L"[@]",
			FG_GREEN);

		return true;
	}
};

int main()
{
	Game game;
	game.ConstructConsole(120, 60, 8, 16);
	game.Start();
}